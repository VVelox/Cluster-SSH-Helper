#!/usr/bin/env perl
#
#This software is Copyright (c) 2019 by Zane C. Bowers-Hadley.
#
#This is free software, licensed under:
#
#  The Artistic License 2.0 (GPL Compatible)

use strict;
use warnings;
use Cluster::SSH::Helper;
use Getopt::Long;

sub version{
	print "cshelper v. 0.1.0\n";
}

sub help{
	print '
-c <file>    Config file.
-h <file>    Hosts file.
-m <method>  Selection to use.
-p           Print the final command before running it.
';
}

if (!defined( $ARGV[0] )) {
	die("Nothing specified to execute");
}

my $config_file;
my $hosts_file;
my $method;
my $print_cmd;
my $command=join(' ', @ARGV);

# get the commandline options
Getopt::Long::Configure ('no_ignore_case');
Getopt::Long::Configure ('bundling');
Getopt::Long::Configure ('pass_through');
Getopt::Long::Configure ('require_order');
GetOptions(
		   'c=s'=>\$config_file,
		   'h=s'=>\$hosts_file,
		   'm=s'=>\$method,
		   'p'=>\$print_cmd,
		   );

my $csh=Cluster::SSH::Helper->new_from_ini( $config_file, $hosts_file );

exit $csh->run({
		   command=>\@ARGV,
		   method=>$method,
		   print_cmd=>$print_cmd,
		   });
